ref: https://zilliz.com.cn/blog/MinHash-LSH-best-dedup-for-model-training
#### **什么是MinHash LSH？**

一般来说，数据去重主要有三条技术路线

- **精确匹配**：借助哈希查找完全相同的文本；
- **近似匹配**：使用 MinHash LSH、Jaccard 相似度等算法发现近似重复；
- **语义匹配**：利用向量嵌入找出语义相似内容。

面对 TB 乃至 PB 级数据量，逐对比对的精确匹配计算量过于庞大；而语义去重又要先生成向量，开销更甚。因而，我们需要像 MinHash LSH 这样的创新性近似方法，在召回率、精度和成本之间取得平衡，使大规模去重切实可行。

### **MinHash**

简单来说，这是一种哈希技术，用于估算两个集合的相似度。想象一下，你有两个文本文档，想知道它们有多像。MinHash会把文档拆分成小块（比如单词或n-gram），然后用哈希函数生成一个“签名”（signature）。两个文档的签名越相似，文档就越像。它的优势是计算快，适合大数据。

![image.png](https://raw.githubusercontent.com/marqu22/image_home/main/main_1060/20251216170414186.png)

**核心要点: 我们针对的是同一个文档中不同的文档片段应用同一个hash func, 然后在这个集合上去最小的值来作为这个位置的代表, (如果两个班级中的英语很好, 说明较大可能是同一个老师教的)**

在计算相似度时，两个文档的 MinHash 签名中哈希值在相同位置对齐的概率提供了其原始分片集 Jaccard 相似度的近似估计。这允许我们无需直接比较较大的原始文本，而是分析其紧凑的 MinHash 签名来有效估计文档相似度。

MinHash 原理涉及使用具有最小哈希值的词来代表整个文档，通过加入额外的哈希函数来提高准确性。小的词变化很可能被忽略，因为它们通常不会影响最小哈希值。相反，更大的变化往往会改变哈希值并更容易被检测。这种方法可以视为对各种词的哈希值进行 min-pooling。
### LSH
即使使用紧凑的 MinHash 签名，在数百万或数十亿文档中比较每一对仍然计算昂贵。这就是局部敏感哈希 (LSH) 的作用。LSH 的关键思想是使用有意造成碰撞的哈希函数 - 相似项更可能哈希到同一个桶中，而不相似的则不会。这与传统的哈希相反，后者旨在避免碰撞。

对于 MinHash，一种流行的 LSH 策略是分带技术：

- **分带 (Banding)**：将每个 MinHash 签名（长度为 N 的向量）分成 b 个带，每个带有 r 个维度 (N = b × r)。
    
- **哈希带**：使用标准哈希函数将每个带（r 个值的子向量）哈希到一个桶中。
    
- **候选对**：如果两个文档在任何带中共享一个桶，它们将被标记为潜在匹配。
    

通过调整带的数目 (b) 和每个带的维度数 (r)，你可以控制召回率、精确率和搜索效率之间的权衡。

举例说明，对于三个具有 128 维 MinHash 签名的文档
![image.png](https://raw.githubusercontent.com/marqu22/image_home/main/main_1060/20251216170554728.png)
关键思想是：高度相似的文档在其 MinHash 签名中会有许多匹配的哈希值。当这些签名被分成带时，即使只有一个带的所有值匹配，也足以将两个文档放到同一个桶中。文档越相似，这种情况在至少一个带中发生的概率越高，从而允许 LSH 在无需穷尽比较所有签名的情况下高效地找出候选对。

简而言之，MinHash + LSH 实现了可扩展的近似去重：**MinHash 将文档压缩成紧凑签名，LSH 通过分组可能的匹配来高效缩小搜索空间**。这就像在人群中发现双胞胎：首先，对每个人快速拍摄特征快照 (MinHash)，分组相似的 (LSH)，然后检查较小的组以找出实际重复项。它特别适合处理非结构化数据，比如文本、图像向量，因为这些数据的高维特性让传统去重方法（如精确匹配）变得低效或不可能。


## AI 总结:
### 📚 MinHash 与 LSH 核心概念笔记

####  🚀 一、 MinHash (最小哈希)

MinHash 的核心目标：**将超大集合压缩成短小的数字签名，同时保持相似度特性。**

| 类别     | 概念/动作                    | 描述                                                    | 关键性质                        |
| ------ | ------------------------ | ----------------------------------------------------- | --------------------------- |
| **基础** | **Jaccard 相似度** (J(A,B)) | 两个集合的**共同点**占**总内容**的比例。                              | $J(A,B) = \frac{            |
| **输入** | **Shingle**              | 文档中的连续子串（例如，k-gram），是集合 A 和 B 的元素。                    | 是进行哈希操作的基础单位。               |
| **动作** | **哈希函数 h**               | 将每个 Shingle 映射到一个大的整数空间，实现**随机乱序**。                   | 保证每个元素有同等机会成为最小值。           |
| **输出** | **MinHash 值** (mini​)    | 在一个特定的哈希函数 hi​ 下，集合 A 中所有 Shingle 的哈希值中的**最小值**。      | mini​(A)=minx∈A​{hi​(x)}    |
| **核心** | **MinHash 签名** (MA​)     | 由 n 个 MinHash 值组成的向量。                                 | MA​=[min1​,min2​,…,minn​]   |
| **精髓** | **关键性质**                 | 两个集合的 MinHash 值在**某一维**相等的概率，**恰好等于**它们的 Jaccard 相似度。 | P[mini​(A)=mini​(B)]=J(A,B) |
| **应用** | **相似度估计**                | 签名中**相同位置值相等的比例**，近似等于原始集合的 Jaccard 相似度。              | Sim(MA​,MB​)≈J(A,B)         |
### 🎯 二、 LSH (局部敏感哈希)

LSH 的核心目标：**利用 MinHash 签名，将相似的文档高概率地分到同一个“桶”中，实现高效的相似搜索。**

| 类别     | 概念/动作              | 描述                                                          | 目的                                     |
| ------ | ------------------ | ----------------------------------------------------------- | -------------------------------------- |
| **输入** | **MinHash 签名**     | 来自 MinHash 算法的短小指纹向量（如 128 维）。                              | LSH 操作的基础数据。                           |
| **动作** | **分块 (Banding)**   | 将 n 维签名垂直切割成 b 个**块 (Band)**，每块有 r 行 (Row)， n=b×r。          | 将“整体相似”问题转化为“局部匹配”问题。                  |
| **关键** | **局部哈希**           | 对每个 Band 的 r 个值进行**再哈希**，将这个 Band 的内容映射到一个**桶 (Bucket)** 中。 | 使得 Band 内容完全相同的文档，必然落入同一个桶。            |
| **输出** | **LSH 桶 (Bucket)** | 存储了在**至少一个 Band** 中完全匹配的文档 ID。                              | 桶内文档即为**相似候选对**。                       |
| **精髓** | **S 形曲线**          | 候选对概率 P 与相似度 s 之间的非线性关系。                                    | 具有陡峭的**阈值**，相似度低于阈值几乎不被选中，高于阈值几乎总是被选中。 |
| **参数** | **b (Band 数量)**    | 决定了**独立试验次数**，影响 S 曲线的平缓度。                                  | 越大，曲线越陡峭（更严格地要求相似度）。                   |
| **参数** | **r (Row 数量)**     | 决定了**匹配难度**（sr），影响 S 曲线的阈值位置。                               | 越大，Band 完全匹配的难度越高。                     |
| **效益** | **高效搜索**           | 避免 O(N2) 的两两比较，只需检查 LSH 桶内的**候选对**，实现近乎线性的搜索时间。             | 大幅提高在大规模数据集上的相似性查找效率。                  |

MinHash 负责将大文件“瘦身”成短签名；LSH 负责将这些短签名“分组”，以便我们能快速找到相似的文档对。